import React from 'react'
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { Box, LegacyCard, Text, VerticalStack } from '@shopify/polaris';
import { coy } from 'react-syntax-highlighter/dist/esm/styles/prism';
import func from '@/util/func';
import transform from '../../../components/shared/customDiffEditor';

const HttpRequestResponseViewer = ({ data }) => {
  const requestJsonObj = func.requestJson(data, [])
  const responseJsonObj = func.responseJson(data, [])

  const formattedRequest = transform.formatData(requestJsonObj,"http")
  const formattedResponse = transform.formatData(responseJsonObj,"http")

  const MAX_CHARACTERS = 15_000

  const truncateContent = (content) => {
    return content.length > MAX_CHARACTERS ? content.slice(0, MAX_CHARACTERS) + '...\n' : content
  }
  
  return (
    <VerticalStack gap={3}>
        <Box>
            <LegacyCard>
                <Box padding={3} borderRadius='2'>
                    <Text>Request</Text>
                    <Box style={{maxHeight: '4000px', overflowY: 'hidden'}} overflowY='hidden'>
                      <SyntaxHighlighter lineProps={{style: {whiteSpace: 'pre-wrap', wordBreak: 'break-all', display: 'block'}}} wrapLongLines={true} showLineNumbers={true} language="http" style={coy}>
                          {truncateContent(formattedRequest)}
                      </SyntaxHighlighter>
                    </Box>
                </Box>
            </LegacyCard>
        </Box>

        <Box>
            <LegacyCard>
                <Box padding={3} borderRadius='2'>
                    <Text>Response</Text>
                    <Box style={{maxHeight: '4000px', overflowY: 'hidden'}} overflowY='hidden'>
                      <SyntaxHighlighter lineProps={{style: {whiteSpace: 'pre-wrap', wordBreak: 'break-all', display: 'block'}}} wrapLongLines={true} showLineNumbers={true} language="http" style={coy}>
                          {truncateContent(formattedResponse)}
                      </SyntaxHighlighter>
                    </Box>
                </Box>
            </LegacyCard>
        </Box>
    </VerticalStack>
  )
}

export default HttpRequestResponseViewer
